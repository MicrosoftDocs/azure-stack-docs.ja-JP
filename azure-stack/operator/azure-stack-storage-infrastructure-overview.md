---
title: Azure Stack Hub のストレージ インフラストラクチャの概要
titleSuffix: Azure Stack
description: Azure Stack Hub 用のストレージ インフラストラクチャを管理する方法について説明します。
author: IngridAtMicrosoft
ms.topic: article
ms.date: 5/11/2020
ms.author: inhenkel
ms.lastreviewed: 5/5/2020
ms.reviewer: jiaha
ms.custom: contperfq4
ms.openlocfilehash: 0712caec89d3a6e2203ca780b4877b330953c61c
ms.sourcegitcommit: 4a8d7203fd06aeb2c3026d31ffec9d4fbd403613
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/12/2020
ms.locfileid: "83202486"
---
# <a name="azure-stack-hub-storage-infrastructure-overview"></a>Azure Stack Hub のストレージ インフラストラクチャの概要

この記事では、Azure Stack Hub のストレージ インフラストラクチャの概要について説明します。

## <a name="understand-drives-and-volumes"></a>ドライブとボリュームについて

### <a name="drives"></a>ドライブ

Windows Server ソフトウェアの機能を利用して、Azure Stack Hub では、記憶域スペース ダイレクト (S2D) と Windows Server フェールオーバー クラスタリングの組み合わせでストレージ機能が定義されています。 この組み合わせにより、パフォーマンス、スケーラビリティ、回復性の優れたストレージ サービスが提供されます。

Azure Stack Hub の統合システム パートナーからは、ストレージの幅広い柔軟性など、バリエーション豊かなソリューションが提供されています。 現在、サポートされている次の 3 つのドライブの種類から 2 つまでを選択できます:NVMe (Non-Volatile Memory Express)、SATA/SAS SSD (ソリッドステート ドライブ)、HDD (ハード ディスク ドライブ)。 

記憶域スペース ダイレクトは、キャッシュを使ってストレージのパフォーマンスを最大化する機能です。 1 種類のドライブ (NVMe または SSD) を備えた Azure Stack Hub アプライアンスでは、すべてのドライブが容量に使用されます。 2 種類のドライブがある場合は、記憶域スペース ダイレクトにより "最も高速な" 種類のドライブ (NVMe &gt; SSD &gt; HDD) がすべて、自動的にキャッシュとして使用されます。 残りのドライブは、キャパシティとして使用されます。 ドライブは "オールフラッシュ" と "ハイブリッド" のいずれかのデプロイにグループ化することができます。

![Azure Stack Hub のストレージ インフラストラクチャ](media/azure-stack-storage-infrastructure-overview/image1.png)

オールフラッシュ型のデプロイは、ストレージのパフォーマンスを最大化することを目標としたものであり、回転式のハード HDD が含まれません。

![Azure Stack Hub のストレージ インフラストラクチャ](media/azure-stack-storage-infrastructure-overview/image2.png)

ハイブリッド型のデプロイは、パフォーマンスとキャパシティのバランスの調和またはキャパシティの最大化を目標としたもので、回転式の HDD が含まれます。

キャッシュの動作は、キャッシュの対象となるドライブの種類に応じて自動的に決まります。 キャッシュの対象が SSD の場合 (SSD のキャッシュを NVMe に保存する場合など) には、書き込みのみがキャッシュに保存されます。 こうすることによって、キャパシティ ドライブに流入するトラフィックの累積量を減らし、キャパシティ ドライブの劣化スピードを遅らせ、ドライブの寿命を延ばしています。 その間、読み取りがキャッシュに保存されることはありません。 キャッシュに保存されないのは、読み取りがフラッシュの寿命に及ぼす影響はわずかであり、SSD の読み取り遅延は常に低いためです。 キャッシュの対象が HDD の場合 (HDD のキャッシュを SSD に保存する場合など) には、読み取りと書き込みのどちらにもフラッシュと同等の待ち時間 (多くの場合、約 10 倍のスピード) を実現できるよう、読み取りと書き込みの両方がキャッシュに保存されます。

![Azure Stack Hub のストレージ インフラストラクチャ](media/azure-stack-storage-infrastructure-overview/image3.png)

利用できるストレージ構成については、Azure Stack Hub OEM パートナー (https://azure.microsoft.com/overview/azure-stack/partners/) にお問い合わせのうえ、仕様の詳細をご確認ください。

> [!Note]  
> Azure Stack Hub アプライアンスは、HDD ドライブと SSD (または NVMe) ドライブの両方を備えたハイブリッド デプロイとしてお届けすることができます。 ただし、高速な方のドライブはキャッシュ ドライブ、残りのドライブはすべてキャパシティ ドライブ プールとして、それぞれ使用されます。 テナント データ (BLOB、テーブル、キュー、ディスク) は、キャパシティ ドライブに保存されます。 Premium ディスクをプロビジョニングしたり、Premium ストレージ アカウントの種類を選択しても、オブジェクトが SSD ドライブまたは NVMe ドライブに割り当てられる保証はありません。

### <a name="volumes"></a>ボリューム

"*ストレージ サービス*" では、利用可能なストレージが複数のボリュームにパーティション分割されます。分割によってできた個別のボリュームは、システム データとテナント データを保持するために割り当てられます。 記憶域プール内のドライブを組み合わせたボリュームでは、記憶域スペース ダイレクトのフォールト トレランス、スケーラビリティ、パフォーマンス面のメリットが提供されます。

![Azure Stack Hub のストレージ インフラストラクチャ](media/azure-stack-storage-infrastructure-overview/image4.png)

Azure Stack Hub の記憶域プール上に作成されるボリュームは 3 種類あります。

- インフラストラクチャ: Azure Stack Hub インフラストラクチャ VM とコア サービスによって使用されるファイルがホストされます。

- VM 一時: テナント VM にアタッチされている一時ディスクと、そのディスクに格納されているデータをホストします。

- オブジェクト ストア: BLOB、テーブル、キュー、VM ディスクにサービスを提供するテナント データがホストされます。

複数ノードのデプロイの場合、インフラストラクチャ ボリュームの数は 3 つです。これに対して、VM 一時ボリュームとオブジェクト ストア ボリュームの数は、Azure Stack Hub デプロイ内のノードの数に等しくなります。

- 4 ノードのデプロイでは、VM 一時ボリューム、オブジェクト ストア ボリュームとも、同一のものがそれぞれ 4 つずつあります。

- クラスターに新しいノードを 1 つ追加すると、両方の種類のボリュームが 1 つずつ新たに作成されます。

- ボリュームの数は、ノードに不具合が発生したり、ノードを削除したりした場合でもそのまま維持されます。

- Azure Stack Development Kit を使用する場合は、複数の共有を含む 1 つのボリュームがあります。

記憶域スペース ダイレクト内のボリュームでは、ドライブやサーバーの障害などのハードウェアの問題から保護するための回復性が提供されます。 また、ソフトウェアの更新など、サーバーのメンテナンスを通して継続的な可用性が実現されます。 Azure Stack Hub のデプロイでは、データの回復性確保のために 3 方向のミラーリングが使用されます。 テナント データのコピーが 3 つ、別々のサーバーに書き込まれ、キャッシュに保存されます。

![Azure Stack Hub のストレージ インフラストラクチャ](media/azure-stack-storage-infrastructure-overview/image5.png)

ミラーリングを使ってあらゆるデータのコピーを複数保持することによって、フォールト トレランスが実現します。 データをどのようにストライピングおよび配置するかは重要な問題ですが、ミラーリングを使って格納するデータがいずれも、そのままの形で複数回書き込まれるという点は間違いありません。 コピーはそれぞれ、障害の発生が個別にとどまることが想定される別々の物理ハードウェア (別のサーバーの別のドライブ) に書き込まれます。 3 方向ミラーリングでは、一度に 2 台以上のハードウェア (ドライブまたはサーバー) に問題が発生した場合でも、安全に耐えることができます。 たとえば、あるサーバーの再起動中に別のドライブまたはサーバーに突然障害が発生した場合でも、あらゆるデータが安全かつアクセス可能な状態に保たれます。

## <a name="next-step"></a>次のステップ

[ストレージ容量の管理](azure-stack-manage-storage-shares.md) 
