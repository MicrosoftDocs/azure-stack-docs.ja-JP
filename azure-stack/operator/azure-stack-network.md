---
title: Azure Stack Hub のためのネットワーク統合計画
description: Azure Stack Hub 統合システムとのデータセンターのネットワーク統合を計画する方法について説明します。
author: ihenkel
ms.topic: article
ms.date: 10/23/2019
ms.author: inhenkel
ms.reviewer: wamota
ms.lastreviewed: 06/04/2019
ms.openlocfilehash: cd1e5e66b5cdb893591fc4116b335ff399ace736
ms.sourcegitcommit: bcd2c6cd08526723f4b770b149c5e9a4fd5ef0ee
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/01/2020
ms.locfileid: "76922624"
---
# <a name="network-integration-planning-for-azure-stack-hub"></a>Azure Stack Hub のためのネットワーク統合計画

この記事では、Azure Stack Hub を既存のネットワーク環境に統合する最善の方法を決定するために役立つ Azure Stack Hub ネットワーク インフラストラクチャの情報を提供します。

> [!NOTE]
> Azure Stack Hub から外部の DNS 名 (たとえば www\.bing.com) を解決するには、DNS 要求を転送するための DNS サーバーを提供する必要があります。 Azure Stack Hub の DNS 要件の詳細については、[Azure Stack Hub とデータセンターの統合 - DNS](azure-stack-integrate-dns.md)に関するページをご覧ください。

## <a name="physical-network-design"></a>物理ネットワークの設計

Azure Stack Hub ソリューションには、その操作やサービスをサポートするための回復性と可用性の高い物理インフラストラクチャが必要です。 ToR から境界スイッチへのアップリンクは、SFP+ または SFP28 メディア、1 GB、10 GB、または 25 GB の速度に制限されます。 OEM (Original Equipment Manufacturer) ハードウェア ベンダーに可用性を確認してください。 推奨される設計を次の図に示します。

![推奨される Azure Stack Hub ネットワークの設計](media/azure-stack-network/recommended-design.png)


## <a name="logical-networks"></a>論理ネットワーク

論理ネットワークは、基礎となる物理ネットワーク インフラストラクチャの抽象化を表します。 これらは、ホスト、仮想マシン (VM)、およびサービスへのネットワーク割り当てを整理および簡略化するために使用されます。 論理ネットワーク作成の一部として、それぞれの物理的な場所にある論理ネットワークに関連付けられた仮想ローカル エリア ネットワーク (VLAN)、IP サブネット、および IP サブネット/VLAN ペアを定義するためのネットワーク サイトが作成されます。

次の表に、論理ネットワークと、計画する必要がある関連付けられた IPv4 サブネット範囲を示します。

| 論理ネットワーク | 説明 | Size | 
| -------- | ------------- | ------------ | 
| パブリック VIP | Azure Stack Hub では、このネットワークからの合計 31 個のアドレスが使用されます。 少数の Azure Stack Hub サービスに 8 個のパブリック IP アドレスが使用されます。残りはテナント VM によって使用されます。 App Service と SQL リソース プロバイダーを使用する場合は、さらに 7 個のアドレスを使用します。 残りの 15 個の IP アドレスは、将来の Azure サービスのために予約されています。 | /26 (62 ホスト) - /22 (1022 ホスト)<br><br>推奨 = /24 (254 ホスト) | 
| スイッチのインフラストラクチャ | ルーティングを目的としたポイント ツー ポイント IP アドレス (スイッチ管理専用インターフェイス) と、スイッチに割り当てられたループバック アドレス。 | /26 | 
| インフラストラクチャ | Azure Stack Hub 内部コンポーネントの通信に使用します。 | /24 |
| プライベート | ストレージ ネットワーク、プライベート VIP、インフラストラクチャ コンテナー、およびその他の内部機能のために使用されます。 1910 以降、このサブネットのサイズは /20 に変更されます。 詳細については、この記事の「[プライベート ネットワーク](#private-network)」セクションをご覧ください。 | /20 | 
| BMC | 物理ホスト上の BMC との通信に使用します。 | /26 | 
| | | |

> [!NOTE]
> システムがバージョン 1910 に更新されると、ポータルにアラートが表示され、新しい PEP コマンドレット **Set-AzsPrivateNetwork** を実行して新しい/20 プライベート IP 空間を追加するようにオペレーターに通知されます。 コマンドレットの実行方法については、[1910 のリリースノート](release-notes.md) を参照してください。 /20 プライベート IP 空間のガイダンスと選択方法の詳細については、この記事の「[プライベート ネットワーク](#private-network)」セクションを参照してください。

## <a name="network-infrastructure"></a>ネットワーク インフラストラクチャ

Azure Stack Hub のネットワーク インフラストラクチャは、スイッチ上に構成されたいくつかの論理ネットワークから成ります。 それらの論理ネットワークを次の図に示し、各論理ネットワークと TOR (top-of-rack)、ベースボード管理コントローラー (BMC)、境界 (カスタマー ネットワーク) スイッチを統合する方法を説明します。

![論理ネットワーク図とスイッチ接続](media/azure-stack-network/NetworkDiagram.png)

### <a name="bmc-network"></a>BMC ネットワーク

このネットワークは、すべてのベースボード管理コントローラー (BMC またはサービス プロセッサとも呼ばれます) の管理ネットワークへの接続専用です。 例として、iDRAC、iLO、iBMC などがあります。 どの BMC ノードとの通信にも、1 つの BMC アカウントだけが使用されます。 存在する場合は、ハードウェア ライフサイクル ホスト (HLH) がこのネットワーク上に配置され、ハードウェアのメンテナンスまたは監視のための OEM 固有のソフトウェアが提供される可能性があります。

HLH では、デプロイメント仮想マシン (DVM) もホストされます。 DVM は Azure Stack Hub のデプロイ中に使用され、デプロイが完了すると削除されます。 接続されたデプロイのシナリオでは、DVM には、複数のコンポーネントのテスト、検証、およびアクセスのためにインターネット アクセスが必要です。 これらのコンポーネントは、企業ネットワークの内外に配置できます (たとえば NTP、DNS、Azure)。 接続の要件について詳しくは、[「Azure Stack Hub ファイアウォールの統合」の NAT に関するセクション](azure-stack-firewall.md#network-address-translation)をご覧ください。

### <a name="private-network"></a>プライベート ネットワーク

この /20 (4096 IP) ネットワークは Azure Stack Hub リージョンに対してプライベートであり (Azure Stack Hub システムの境界スイッチ デバイスを超えてルーティングされることはありません)、複数のサブネットに分割されます。いくつかの例を次に示します。

- **ストレージ ネットワーク**:スペース ダイレクトおよびサーバー メッセージ ブロック (SMB) ストレージ トラフィックの使用や VM のライブ マイグレーションをサポートするために使用される /25 (128 IP) ネットワーク。
- **内部仮想 IP ネットワーク**:ソフトウェア ロード バランサーのための内部のみの VIP 専用の /25 ネットワーク。
- **コンテナー ネットワーク**:インフラストラクチャ サービスを実行しているコンテナー間の内部トラフィックのみを対象とする専用 /23 (512 IP) ネットワーク。

1910 以降、プライベート ネットワークのサイズがプライベート IP 空間の /20 (4096 IP) に変更されます。 このネットワークは Azure Stack Hub リージョンに対してプライベートになり (Azure Stack Hub システムの境界スイッチ デバイスを超えてルーティングされることはありません)、データセンター内の複数の Azure Stack Hub システムで再利用できます。 ネットワークは Azure Stack Hub に対してプライベートですが、データセンター内の他のネットワークと重複することはできません。 重複が発生した場合、Azure Stack Hub によって企業ネットワーク トラフィックが外部にルーティングされない可能性があります。 プライベート IP 空間のガイダンスについては、[RFC 1918](https://tools.ietf.org/html/rfc1918) に従うことをお勧めします。

この /20 プライベート IP 空間は、今後のリリースで Azure Stack Hub システムの内部インフラストラクチャをコンテナー上で実行できるように、複数のネットワークに分割されます。 詳しくは、[1910 リリース ノート](release-notes.md)をご覧ください。 さらに、この新しいプライベート IP 空間によって、デプロイ前に必要となるルーティング可能な IP 空間を減少させるための継続的な作業が可能になります。

1910 より前にデプロイされたシステムでは、この /20 サブネットは、1910 の更新後にシステムに入力される追加のネットワークになります。 追加のネットワークは、**Set-AzsPrivateNetwork** PEP コマンドレットを使用して、システムに提供する必要があります。 このコマンドレットのガイダンスについては、[1910 リリースノート](release-notes.md)を参照してください。

### <a name="azure-stack-hub-infrastructure-network"></a>Azure Stack Hub インフラストラクチャ ネットワーク

この /24 ネットワークは、内部の Azure Stack Hub コンポーネントが互いにデータを通信したり交換したりできるように、これらのコンポーネント専用です。 このサブネットは、データセンターへの Azure Stack Hub ソリューションの外部にルーティングできます。 このサブネットでは、パブリックまたはインターネットでルーティング可能な IP アドレスを使用しないことをお勧めします。 このネットワークは境界にアドバタイズされますが、そのほとんどの IP はアクセス制御リスト (ACL) によって保護されています。 アクセスが許可される IP は、サイズが /27 ネットワークと同等であり、[特権エンド ポイント (PEP)](azure-stack-privileged-endpoint.md) や [Azure Stack Hub Backup](azure-stack-backup-reference.md) などのホスト サービスと同等の小さな範囲内にあります。

### <a name="public-vip-network"></a>パブリック VIP ネットワーク

パブリック VIP ネットワークは、Azure Stack Hub 内のネットワーク コントローラーに割り当てられます。 これはスイッチ上の論理ネットワークではありません。 SLB はアドレスのプールを使用して、テナント ワークロードに /32 ネットワークを割り当てます。 スイッチのルーティング テーブルでは、これらの /32 IP は BGP 経由で使用可能なルートとしてアドバタイズされます。 このネットワークには外部からアクセス可能な、つまりパブリック IP アドレスが含まれています。 Azure Stack Hub インフラストラクチャは、このパブリック VIP ネットワークの最初の 31 個のアドレスを予約し、残りはテナント VM によって使用されます。 このサブネット上のネットワーク サイズは、最小 /26 (64 のホスト) から最大 /22 (1022 のホスト) までの範囲があります。 /24 ネットワークを計画することをお勧めします。

### <a name="switch-infrastructure-network"></a>スイッチ インフラストラクチャ ネットワーク

この /26 ネットワークは、ルーティング可能なポイント ツー ポイント IP /30 (2 つのホスト IP) サブネット、およびインバンド スイッチ管理と BGP ルーター ID に専用の /32 サブネットであるループバックを含むサブネットです。 この範囲の IP アドレスを、Azure Stack Hub ソリューションの外部のデータセンターにルーティング可能にする必要があります。 それらは、プライベート IP またはパブリック IP のどちらでもかまいません。

### <a name="switch-management-network"></a>スイッチ管理ネットワーク

この /29 (6 つのホスト IP) ネットワークは、スイッチの管理ポートの接続専用です。 これにより、デプロイ、管理、およびトラブルシューティングのためのアウトオブバンド アクセスが可能になります。 これは、上で説明したスイッチ インフラストラクチャ ネットワークから計算されます。

## <a name="permitted-networks"></a>許可されるネットワーク

1910 以降、デプロイ ワークシートに新しいフィールドが追加され、それによって、オペレーターは、いくつかのアクセス制御リスト (ACL) を変更して、信頼されたデータセンター ネットワーク範囲から、ネットワーク デバイス管理インターフェイスとハードウェア ライフサイクル ホスト (HLH) にアクセスできるようになります。 アクセス制御リストの変更によって、オペレーターは、特定のネットワーク範囲内の管理ジャンプボックス VM に、スイッチ管理インターフェイス、HLH OS、および HLH BMC へのアクセスを許可することができます。 オペレーターは、このリストに 1 つまたは複数のサブネットを指定できます。空白のままにすると、既定でアクセスが拒否されます。 「[Azure Stack Hub スイッチ構成の特定の設定を変更する](azure-stack-customer-defined.md#access-control-list-updates)」で説明されていたデプロイ後に実行する必要がある手動介入に代わって、この新機能が使用されます。

## <a name="next-steps"></a>次のステップ

ネットワーク計画:[境界接続](azure-stack-border-connectivity.md)を確認します。
