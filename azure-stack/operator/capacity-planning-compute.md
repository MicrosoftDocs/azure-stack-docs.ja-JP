---
title: Azure Stack のためのコンピューティング能力の計画 | Microsoft Docs
description: Azure Stack デプロイのためのコンピューティング能力の計画について説明します。
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/03/2019
ms.author: mabrigg
ms.reviewer: prchint
ms.lastreviewed: 04/03/2019
ms.custom: ''
ms.openlocfilehash: 907a10caa2a23b58d0c63ee1abb7f4e4a074d1a1
ms.sourcegitcommit: 2a4321a9cf7bef2955610230f7e057e0163de779
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/14/2019
ms.locfileid: "65618917"
---
# <a name="azure-stack-compute-capacity-planning"></a>Azure Stack コンピューティング能力の計画
[Azure Stack でサポートされる VM サイズ](../user/azure-stack-vm-sizes.md)は、Azure でサポートされているもののサブセットです。 Azure では、リソース (サーバーのローカルおよびサービス レベル) の過剰消費を防ぐため、多くのベクターに沿ってリソースの制限を適用します。 テナントの消費量にいくつかの制限を適用しないと、あるテナントでリソースが過剰消費された場合に、別のテナントのエクスペリエンスに影響します。 VM からのネットワーク送信の場合、Azure Stack では Azure の制限と一致する帯域幅の上限が設けられます。 ストレージ リソースの場合、テナントによるストレージ アクセスのためのリソースの基本的な過剰消費を防ぐため、Azure Stack にストレージ IOPS 制限が実装されています。  

## <a name="vm-placement-and-virtual-to-physical-core-overprovisioning"></a>VM の配置および仮想対物理コアのオーバープロビジョニング
Azure Stack には、テナントで、VM 配置のために使用する特定のサーバーを指定する方法はありません。 VM を配置するときの唯一の考慮事項は、その VM の種類に対して十分なメモリがホスト上にあるかどうかです。 Azure Stack でメモリがオーバーコミットされることはありませんが、コア数のオーバーコミットは許可されます。 配置アルゴリズムでは、既存の仮想対物理コアのオーバープロビジョニングの比率を係数と見なさないため、各ホストの比率が異なる可能性があります。 

Azure では、マルチ VM 運用システムの高可用性を実現するため、VM が複数の障害ドメインに分散される可用性セットに配置されます。 Azure Stack では、可用性セット内の障害ドメインは、スケール ユニット内の 1 つのノードとして定義されます。

Azure Stack のインフラストラクチャは障害に対する回復性を備えていますが、基盤となっているテクノロジ (フェールオーバー クラスタリング) では、ハードウェア障害が発生した場合にその影響を受ける物理サーバー上の VM に多少のダウンタイムが発生します。 現在、Azure Stack では、Azure との一貫性がある最大 3 つの障害ドメインを含む可用性セットを用意することがサポートされています。 可用性セットに配置された VM は、複数の障害ドメイン (Azure Stack ノード) にできる限り均等に分散させることによって、互いに物理的に分離されます。 ハードウェア障害が発生した場合、障害が発生した障害ドメインの VM は他のノードで再起動されますが、可能であれば、同じ可用性セット内の他の VM とは別の障害ドメインに保持されます。 ハードウェアがオンラインに戻ると、高可用性を維持するために VM の再配置が行われます。

高可用性を実現するために Azure で使用されるもう 1 つの概念は、可用性セット内の更新ドメインの形式になります。 更新ドメインは、メンテナンスや再起動が同時に行われる可能性のある、基盤となるハードウェアの論理グループです。 Azure Stack では、VM のホストが更新される前に、クラスター内の他のオンライン ホストに VM がライブ マイグレーションされます。 ホスト更新の際にテナントのダウンタイムは発生しないため、Azure Stack の更新ドメイン機能は、Azure とテンプレートの互換性を保つためにのみ存在します。

## <a name="azure-stack-resiliency-resources"></a>Azure Stack の回復性のあるリソース
Azure Stack 統合システムの修正プログラムと更新プログラムの適用を考慮するため、また、物理的なハードウェア障害に対する回復性を持たせるために、サーバーの合計メモリの一部は予約されており、テナントの仮想マシン (VM) の配置には使用できません。

サーバーで障害が発生した場合、その障害のあるサーバーでホストされている VM は、残りの利用可能なサーバーで再起動され、VM の可用性が確保されます。 同様に、修正プログラムや更新プログラムのプロセス中は、サーバーで実行されているすべての VM が他の利用可能なサーバーにライブ マイグレーションされます。 この VM の管理または移動を実現できるのは、再起動または移行が可能な予約容量がある場合のみです。

次の計算では、テナントの VM 配置で使用できる、利用可能なメモリの合計が算出されます。 このメモリ容量は、Azure Stack スケール ユニットの全体に対するものです。

  VM 配置で利用可能なメモリ = サーバーのメモリ合計 – 回復性のための予約 - 実行中の VM によって使用されているメモリ - Azure Stack インフラストラクチャのオーバーヘッド <sup>1</sup>

  回復性のための予約 = H + R * ((N-1) * H) + V * (N-2)

> 各値の説明:
> - H = 単一サーバーのメモリ サイズ
> - N = スケール ユニットのサイズ (サーバーの数)
> - R = OS オーバーヘッドのためのオペレーティング システムの予約<sup>2</sup>
> - V = スケール ユニット内の最大 VM

  <sup>1</sup> Azure Stack インフラストラクチャのオーバーヘッド = 230 GB

  <sup>2</sup> オーバーヘッドのためのオペレーティング システムの予約 = ノード メモリの 15%。 オペレーティング システムの予約値は概算であり、サーバーおよび一般的なオペレーティング システムのオーバーヘッドの物理メモリ容量によって異なります。

値 V (スケール ユニット内の最大 VM) は、最大テナント VM メモリ サイズに動的に基づきます。 たとえば、最大 VM 値は、7 GB、112 GB、または Azure Stack ソリューションでサポートされるその他の VM メモリのサイズになる場合があります。

上記の計算は概算であり、Azure Stack の現行バージョンに基づいて変更される可能性があります。 テナントの VM とサービスをデプロイできるかどうかは、デプロイされるソリューションの詳細に基づきます。 この計算例は単なるガイドであり、VM をデプロイできるかどうかを示す絶対的な答えではありません。



## <a name="next-steps"></a>次の手順
[ストレージ容量の計画](capacity-planning-storage.md)
