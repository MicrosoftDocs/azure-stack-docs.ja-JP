---
title: Infrastructure Backup サービスのリファレンス | Microsoft Docs
description: Azure Stack の Infrastructure Backup サービスの参照資料。
services: azure-stack
documentationcenter: ''
author: justinha
manager: femila
editor: ''
ms.assetid: D6EC0224-97EA-446C-BC95-A3D32F668E2C
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 10/25/2018
ms.openlocfilehash: 282d6f3a501550e49424c257b928e708f63ccadc
ms.sourcegitcommit: 245a4054a52e54d5989d6148fbbe386e1b2aa49c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/13/2019
ms.locfileid: "70974866"
---
# <a name="infrastructure-backup-service-reference"></a>インフラストラクチャ バックアップ サービスのリファレンス

## <a name="azure-backup-infrastructure"></a>Azure バックアップ インフラストラクチャ

*適用対象:Azure Stack 統合システムと Azure Stack Development Kit*

Azure Stack は、ポータル (Azure Resource Manager) と全体的なインフラストラクチャ管理エクスペリエンスから成る多数のサービスで構成されています。 Azure Stack の管理エクスペリエンスはアプリと同様で、ソリューションのオペレーターがさらされる複雑さを緩和することに焦点を当てています。

Infrastructure Backup サービスは、インフラストラクチャ サービス用のデータのバックアップや復元の複雑さを表面化させずに、オペレーターがソリューションの管理やユーザーに対する SLA の維持に確実に専念できるように設計されています。

バックアップを同一システム上に保存しないようにするには、バックアップ データを外部共有にエクスポートする必要があります。 外部共有が必要となることで、管理者はデータの格納場所を既存の社内 BC/DR ポリシーに基づいて柔軟に決定できます。

### <a name="infrastructure-backup-service-components"></a>Infrastructure Backup サービスのコンポーネント

Infrastructure Backup サービスには、次のコンポーネントが含まれています。

 - **インフラストラクチャ バックアップ コントローラー**  
 インフラストラクチャ バックアップ コント ローラーは、各 Azure Stack クラウド内にインスタンス化され、配置されています。
 - **バックアップ リソース プロバイダー**  
 バックアップ リソース プロバイダー (バックアップ RP) は、ユーザー インターフェイスと、Azure Stack インフラストラクチャ向けの基本バックアップ機能を公開する API で構成されています。

#### <a name="infrastructure-backup-controller"></a>インフラストラクチャ バックアップ コントローラー

Infrastructure Backup コント ローラーは、Azure Stack クラウド向けにインスタンス化された Service Fabric サービスです。 バックアップ リソースはリージョン レベルで作成され、AD、CA、Azure Resource Manager、CRP、SRP、NRP、Key Vault、RBAC からのリージョン固有のサービス データを記録します。

### <a name="backup-resource-provider"></a>バックアップ リソース プロバイダー

バックアップ リソース プロバイダーは、Azure Stack ポータルで基本構成用のユーザー インターフェイスと、バックアップ リソースの一覧を表示します。 オペレーターは、ユーザー インターフェイスで次のアクションを行うことができます。

 - 初めてバックアップを有効にする場合に、外部の保存場所、資格情報、暗号化キーを指定する
 - 完了した作成済みバックアップ リソースや作成中の状態リソースを表示する
 - バックアップ コントローラーがバックアップ データを配置する保存場所を変更する
 - バックアップ コントローラーが外部の保存場所へのアクセスで使用する資格情報を変更する
 - バックアップ コントローラーがバックアップの暗号化で使用する暗号化キーを変更する


## <a name="backup-controller-requirements"></a>バックアップ コントローラーの要件

このセクションでは、Infrastructure Backup サービスの重要な要件について説明します。 Azure Stack インスタンスのバックアップを有効にする前に、次の情報を慎重に確認してください。また、デプロイや後続の操作中にも、必要に応じて再度この情報をご覧になることをお勧めします。

要件は次のとおりです。

  - **ソフトウェア要件** - サポートされる保存場所とサイズ設定のガイダンスを示します。 
  - **ネットワーク要件** - 各種保存場所のネットワーク要件について説明します。  

### <a name="software-requirements"></a>ソフトウェア要件

#### <a name="supported-storage-locations"></a>サポートされる保存場所

| 保存先                                                                 | 詳細                                                                                                                                                  |
|----------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 信頼されたネットワーク環境内のストレージ デバイスでホストされる SMB ファイル共有 | Azure Stack がデプロイされているのと同じデータセンター内、または別のデータセンター内にある SMB 共有。 複数の Azure Stack インスタンスで同じファイル共有を使用できます。 |
| Azure 上の SMB ファイル共有                                                          | 現在、サポートされていません。                                                                                                                                 |
| Azure 上の BLOB ストレージ                                                            | 現在、サポートされていません。                                                                                                                                 |

#### <a name="supported-smb-versions"></a>サポートされる SMB バージョン

| SMB | Version |
|-----|---------|
| SMB | 3.x     |

#### <a name="smb-encryption"></a>SMB 暗号化

**1907 以降**

Infrastructure Backup サービスでは、サーバー側で SMB 暗号化が有効になっている外部の保存場所へのバックアップ データの転送がサポートされています。 サーバーで SMB 暗号化がサポートされていない場合、または機能が有効になっていない場合、Infrastructure Backup サービスでは暗号化されていないデータ転送にフォールバックされます。 外部の保存場所に配置されるバックアップ データは、保存時に常に暗号化され、SMB 暗号化に依存しません。

#### <a name="storage-location-sizing"></a>保存場所のサイズ設定

少なくとも 1 日に 2 回はバックアップを行い、バックアップは最長で 7 日間保持することをお勧めします。 これは、Azure Stack でインフラストラクチャ バックアップを有効にした場合の既定の動作です。

**1907 以降**

***Azure AD ID プロバイダーに接続されているシステム***

| 環境のスケール | バックアップの予測サイズ | 必要な領域の合計サイズ |
|-------------------|--------------------------|--------------------------------|
| 4 ノードから 16 ノード/ASDK   | 1 GB                     | 20 GB                          |

***ADFS 経由で企業の AD ID プロバイダーに接続されているシステム***

| 環境のスケール | バックアップの予測サイズ | 必要な領域の合計サイズ |
|-------------------|--------------------------|--------------------------------|
| 4-16 ノード        | 20 GB                    | 280 GB                        |
| ASDK              | 10 GB                    | 140 GB                        |

**1907 より前**

| 環境のスケール | バックアップの予測サイズ | 必要な領域の合計サイズ |
|-------------------|--------------------------|--------------------------------|
| 4-16 ノード        | 20 GB                    | 280 GB                        |
| ASDK              | 10 GB                    | 140 GB                        |

### <a name="network-requirements"></a>ネットワークの要件

| 保存先                                                                 | 詳細                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 信頼されたネットワーク環境内のストレージ デバイスでホストされる SMB ファイル共有 | Azure Stack インスタンスがファイアウォールで保護された環境に存在する場合、ポート 445 が必須です。 インフラストラクチャ バックアップ コントローラーは、ポート 445 経由で SMB ファイル サーバーへの接続を開始します。 |
| ファイル サーバーの FQDN を使用するには、名前を PEP から解決可能にする必要があります。             |                                                                                                                                                                                         |

> [!Note]  
> 受信ポートを開く必要はありません。

### <a name="encryption-requirements"></a>暗号化の要件

1901 以降の Infrastructure Backup サービスでは、バックアップ データを暗号化するには公開キー (.CER) を含む証明書が使用され、クラウド復旧中にバックアップ データの暗号化を解除するには秘密キー (.PFX) を含む証明書が使用されます。

 - 証明書は、キーのトランスポートに使用され、セキュリティで保護された認証済みの通信を確立するためには使用されません。 このため、証明書は自己署名証明書でもかまいません。 Azure Stack では、この証明書のルートまたは信頼を確認する必要はないため、外部のインターネット アクセスは必要ありません。

自己署名証明書は、公開キーと秘密キーの 2 つの部分で構成されます。

 - バックアップ データの暗号化: バックアップ データの暗号化には、(.CER ファイルにエクスポートされる) 公開キーを含む証明書が使用されます
 - バックアップ データの解読: バックアップ データの暗号化の解除には、(.PFX ファイルにエクスポートされる) 秘密キーを含む証明書が使用されます

公開キー (.CER) を含む証明書は、内部シークレットのローテーションによっては管理されません。 証明書のローテーションを行うには、新しい自己署名証明書を作成し、新しいファイル (.CER) でバックアップの設定を更新する必要があります。 
 
 - 既存のすべてのバックアップは、前の公開キーを使用して暗号化されたままになります。 新しいバックアップでは、新しい公開キーを使用します。
 
秘密キー (.PFX) によるクラウドの復旧中に使用される証明書は、セキュリティ上の理由から、Azure Stack では保存されません。 クラウドの復旧時に、このファイルを明示的に指定する必要があります。  

**下位互換性モード** 1901 以降では、暗号化キーのサポートは非推奨になり、将来のリリースで削除される予定です。 暗号化キーを使用したバックアップが既に有効になっている 1811 から更新した場合、Azure Stack では暗号化キーが引き続き使用されます。 下位互換性モードは、少なくとも 3 リリースでサポートされます。 その後は、証明書が必要になります。

 * 暗号化キーから証明書への更新は、一方向の操作です。  
 * 既存のすべてのバックアップは、暗号化キーを使用して暗号化されたまま残ります。 新しいバックアップでは、証明書が使用されます。 

## <a name="infrastructure-backup-limits"></a>インフラストラクチャ バックアップの制限事項

Microsoft Azure Stack インスタンスを計画、デプロイ、および運用する際には、以下の制限事項を考慮してください。 次の表に制限事項を示します。

### <a name="infrastructure-backup-limits"></a>インフラストラクチャ バックアップの制限事項

| 制限の種類                                                 | 制限        | 説明                                                                                                                                    |
|------------------------------------------------------------------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| バックアップの種類                                                      | 完全のみ    | インフラストラクチャ バックアップ コントローラーでは、完全バックアップのみがサポートされます。 増分バックアップは、サポートされていません。                                          |
| スケジュールされたバックアップ                                                | スケジュールおよび手動  | バックアップ コントローラーでは、スケジュールされたバックアップとオンデマンド バックアップがサポートされます。                                                                                 |
| バックアップ ジョブの最大同時実行数                                   | 1            | バックアップ コントローラーのインスタンスごとに、アクティブなバックアップ ジョブが 1 つのみサポートされます。                                                                  |
| ネットワーク スイッチの構成                                     | この記事で扱わない内容 | ネットワーク スイッチの構成は、管理者が OEM ツールを使用してバックアップする必要があります。 各 OEM ベンダーから提供される Azure Stack 向けマニュアルをご覧ください。 |
| ハードウェア ライフサイクル ホスト                                          | この記事で扱わない内容 | ハードウェア ライフサイクル ホストは、管理者が OEM ツールを使用してバックアップする必要があります。 各 OEM ベンダーから提供される Azure Stack 向けマニュアルをご覧ください。      |
| 最大ファイル共有数                                    | 1            | バックアップ データの格納に使用できるファイル共有は 1 つのみです。                                                                                        |
| App Services、関数、SQL、mysql リソース プロバイダー データのバックアップ | この記事で扱わない内容 | Microsoft 作成の付加価値 RP のデプロイや管理についての公開されたガイダンスをご覧ください。                                                  |
| サードパーティ リソース プロバイダーのバックアップ                              | この記事で扱わない内容 | サードパーティ作成の付加価値 RP のデプロイや管理についての公開されたガイダンスをご覧ください。                                          |

## <a name="next-steps"></a>次の手順

 - 「[Backup and data recovery for Azure Stack with the Infrastructure Backup Service (インフラストラクチャ バックアップ サービスを使用した Azure Stack のバックアップおよびデータ復元)](azure-stack-backup-infrastructure-backup.md)」で、インフラストラクチャ バックアップ サービスの詳細について学びます。
