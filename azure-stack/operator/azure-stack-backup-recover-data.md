---
title: Azure Stack の致命的なデータ損失からの復旧 | Microsoft Docs
description: 致命的なデータ損失が発生した後に Azure Stack のインフラストラクチャ データを回復および復元する方法について学習します。
services: azure-stack
documentationcenter: ''
author: justinha
manager: femila
editor: ''
ms.assetid: 2ECE8580-0BDE-4D4A-9120-1F6771F2E815
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 11/05/2018
ms.openlocfilehash: b2671446594377833609032e27ff02b7c53c763c
ms.sourcegitcommit: 245a4054a52e54d5989d6148fbbe386e1b2aa49c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/13/2019
ms.locfileid: "70974684"
---
# <a name="recover-from-catastrophic-data-loss"></a>致命的なデータ損失からの復旧

*適用対象: Azure Stack 統合システム*

Azure Stack は、データセンターで Azure サービスを実行し、1 つのラックにインストールされているノードが 4 つ程度の小さい環境でも実行できます。 これに対し Azure は、40 を超えるリージョンで、各リージョンにある複数のデータセンターと複数のゾーンで実行されます。 ユーザー リソースは、複数のサーバーやラック、データセンター、リージョンにまたがることができます。 現在、Azure Stack では、クラウド全体を 1 つのラックにしかデプロイできません。 この制限によって、自社データセンターでの致命的なイベントの危険や、製品の重大なバグによるエラーといった危険に、クラウドをさらしてしまうことになります。 障害が発生すると、Azure Stack インスタンスはオフラインになります。 このデータはすべて、本質的に回復できるものではありません。

データ損失の根本原因によっては、インフラストラクチャ サービスを 1 つ修復するだけで済む場合もあれば、Azure Stack インスタンス全体の復元が必要な場合もあります。 同じ場所や別の場所にある別のハードウェアに復元する必要がある場合もあります。

このシナリオでは、障害が発生し、プライベート クラウドを再デプロイする場合の、インストール全体の復旧に取り組みます。

| シナリオ                                                           | データ損失                            | 考慮事項                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| 障害または製品のバグによって引き起こされた、致命的なデータ損失からの復旧 | 全インフラストラクチャ、ユーザー データ、アプリ データ | ユーザーのアプリとデータは、インフラストラクチャ データとは別に保護されている |

## <a name="workflows"></a>Workflows

Azure Stack を保護する過程は、インフラストラクチャとアプリおよびテナントのデータを別々にバックアップすることから始まります。 このドキュメントでは、インフラストラクチャを保護する方法について説明します。 

![Azure Stack のデータ回復ワークフロー — デプロイ](media/azure-stack-backup/azure-stack-backup-workflow1.png)

すべてのデータが失われるという最悪の事態の場合、Azure Stack の復旧とは、その Azure Stack の展開に固有のインフラストラクチャ データとすべてのユーザー データを復元するプロセスを指します。 

![Azure Stack のデータ回復ワークフロー — 再デプロイ](media/azure-stack-backup/azure-stack-backup-workflow2.png)

## <a name="restore"></a>復元

致命的なデータ損失が発生しても、ハードウェアが引き続き使用できる場合は、Azure Stack の再デプロイが必要になります。 再展開の際に、ストレージの場所と、バックアップのアクセスに必要な資格情報を指定できます。 このモードでは、復元の必要があるサービスを指定する必要はありません。 展開ワークフローの一部として、インフラストラクチャ バックアップ コントローラーによってコントロール プレーンの状態が挿入されます。

ハードウェアが使用不能になる障害が発生した場合、再デプロイは新しいハードウェアでのみ可能になります。 代替ハードウェアを注文してから、データセンターに到着するまでの間、再展開には数週間かかることがあります。 コントロール プレーン データの復元は、いつでも可能です。 ただし、再デプロイされたインスタンスのバージョンが、最後のバックアップで使用されたバージョンよりも 2 バージョン以上大きい場合、復元はできません。

| 展開モード | 開始ポイント | 終了ポイント                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| クリーン インストール   | ベースライン ビルド | OEM が Azure Stack を展開して、最新のサポート バージョンに更新します。                                                                                                                                          |
| 回復モード   | ベースライン ビルド | OEM が回復モードで Azure Stack を展開し、利用可能な最新のバックアップに従って、バージョンのマッチング要件を処理します。 OEM が最新のサポート バージョンに更新して、展開を完了します。 |

## <a name="data-in-backups"></a>バックアップ内のデータ

Azure Stack では、クラウド回復モードというタイプの展開がサポートされます。 このモードは、障害や製品のバグによってソリューションが回復不能になったときに Azure Stack を復旧する場合にのみ、使用します。 このデプロイ モードでは、ソリューションに格納されているユーザー データは一切復旧されません。 この展開モードの範囲は、次のデータの復元に限定されます。

 - 展開の入力
 - 内部 ID サービス データ (ADFS デプロイ)
 - フェデレーション ID の構成 (ADFS デプロイ)
 - 内部の証明機関によって使用されるルート証明書
 - Azure Resource Manager 構成のユーザー データ (例: サブスクリプション、プラン、オファー、ストレージ クォータ、ネットワーク クォータ、コンピューティング リソースなど)
 - Key Vault のシークレットと資格情報コンテナー
 - RBAC のポリシー割り当てとロール割り当て

展開の際、ユーザーのサービスとしてのインフラストラクチャ (IaaS) リソースや、サービスとしてのプラットフォーム (PaaS) リソースは、復旧されません。 これらの損失には、IaaS VM、ストレージ アカウント、BLOB、テーブル、ネットワーク構成などが含まれます。 クラウドを復旧する目的は、デプロイの完了後に、オペレーターとユーザーがポータルに再度サインインできることを確実にすることです。 再度サインインしても、ユーザーにリソースは一切表示されません。 ユーザーのサブスクリプションと、管理者によって定義されていた元のプラン、オファー、ポリシーが復元されています。システムに再度サインインするユーザーは、障害が起きる前の元のソリューションであったものと同じ制約で操作することになります。 作業者は、クラウドの復旧が完了したら、付加価値 RP、サード パーティ製 RP、および関連するデータを手動で復元できます。

## <a name="next-steps"></a>次の手順

[インフラストラクチャ バックアップ サービスの使用](azure-stack-backup-best-practices.md)について、ベスト プラクティスを説明します。
