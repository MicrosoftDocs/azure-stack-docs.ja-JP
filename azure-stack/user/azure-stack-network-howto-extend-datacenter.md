---
title: Azure Stack でデータ センターを拡張する方法 | Microsoft Docs
description: Azure Stack でデータ センターを拡張する方法について説明します。
services: azure-stack
author: mattbriggs
ms.service: azure-stack
ms.topic: how-to
ms.date: 10/19/2019
ms.author: mabrigg
ms.reviewer: sijuman
ms.lastreviewed: 10/19/2019
ms.openlocfilehash: 94a9398a68be06d4735e2c082e8dc0a02281b6eb
ms.sourcegitcommit: 58e1911a54ba249a82fa048c7798dadedb95462b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2019
ms.locfileid: "73064968"
---
# <a name="how-to-extend-the-data-center-on-azure-stack"></a>Azure Stack でデータ センターを拡張する方法

*適用対象:Azure Stack 統合システムと Azure Stack Development Kit*

この記事では、Azure Stack を既存のネットワーク環境に統合する方法を決定するために役立つ Azure Stack ストレージ インフラストラクチャの情報を提供します。 Azure Stack の記憶域には制限があります。 ストレージを Azure Stack の外部のストレージおよびローカル データ センターに統合できます。 データ センターの拡張について概要を説明した後、2 つの異なるシナリオを紹介します。 Windows ファイル ストレージ サーバーに接続できます。 Windows iSCSI サーバーに接続することもできます。

## <a name="overview-of-extending-storage-to-azure-stack"></a>ストレージの Azure Stack への拡張に関する概要

この図は、ワークロードを実行している単一の仮想マシンを、データの読み取り/書き込みなどの目的で、外部 (VM や Azure Stack 自体の) ストレージに接続して利用するシナリオを示しています。この記事では、ファイルの簡単な取得に焦点を当てますが、データベース ファイルのリモート ストレージなど、より複雑なシナリオに合わせてこの例を拡張することもできます。

![Azure Stack 拡張ストレージ](./media/azure-stack-network-howto-extend-datacenter/image1.png)

この図では、Azure Stack システム上の VM が複数の NIC を使用してデプロイされていることがわかります。 冗長性だけでなく、ストレージのベスト プラクティスとしても、ターゲットと宛先の間に複数のパスを用意することが重要です。 状況が複雑になるのは、Azure と同様に、Azure Stack の VM にパブリック IP とプライベート IP の両方がある場合です。 外部ストレージから VM に到達する必要がある場合は、パブリック IP を使用する必要があります。これは、プライベート IP は主に Azure Stack システム内、vNet およびサブネット内で使用されるためです。 外部ストレージは、サイト間 VPN を経由して vNet 自体に接続しない限り、VM のプライベート IP 空間と通信できません。 そのため、この例では、パブリック IP 空間を介した通信に注目します。 図のパブリック IP 空間で注目する点は、2 つの異なるパブリック IP プール サブネットがあることです。 既定で、パブリック IP アドレスの目的では Azure Stack には 1 つのプールのみが必要ですが、冗長ルーティングのためには、2 つ目のプールを追加することも考えられます。 ただし、1 つの特定のプールから IP アドレスを選択することはできないため、場合によっては複数の仮想ネットワーク カードにまたがる同じプールのパブリック IP を持つ VM を使用します。

この例では、境界デバイスと外部ストレージ間のルーティングが処理され、トラフィックがネットワークを適切に通過できると想定できます。 この例では、バックボーンが 1 GbE、10 GbE、25 GbE、またはそれより高速かどうかは関係ありませんが、統合を計画する際は、この外部ストレージにアクセスするアプリケーションのパフォーマンス ニーズに対処することを考慮することが重要です。

## <a name="connect-to-a-windows-server-file-server-storage"></a>Windows Server ファイル サーバー ストレージに接続する

このシナリオでは、Azure Stack に Windows Server 2019 仮想マシンをデプロイして構成し、外部ファイル サーバーに接続できるように準備します。これにより、Windows Server 2019 も実行できます。 必要に応じて、SMB マルチチャネルなどの主要な機能を設定して、VM と外部ストレージ間のパフォーマンスと接続を最適化します。

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack"></a>Windows Server 2019 VM を Azure Stack にデプロイする

1.  **Azure Stack 管理者ポータル**から、このシステムが正しく登録され、マーケットプレースに接続されていると仮定して、 **[Marketplace Management]\(マーケットプレースの管理\)** を選択します。次に、WindowsServer 2019 イメージをまだ持っていないと仮定して、 **[Add from Azure]\(Azure から追加\)** を選択し、**Windows Server 2019** を検索し、**Windows Server 2019 Datacenter** イメージを追加します。

    ![](./media/azure-stack-network-howto-extend-datacenter/image2.png)

    Windows Server 2019 イメージのダウンロードには時間がかかる場合があります。

2.  Azure Stack 環境に Windows Server 2019 イメージを用意できたら、Azure Stack ユーザー ポータル**にサインインします。

3.  Azure Stack ユーザー ポータルにログインしたら、[オファーのサブスクリプション](https://docs.microsoft.com/azure-stack/operator/azure-stack-subscribe-plan-provision-vm?view=azs-1908)があることを確認します。これを使用して、IaaS リソース (コンピューティング、ストレージ、ネットワーク) をプロビジョニングできます。

4.  サブスクリプションを用意できたら、Azure Stack ユーザー ポータルの**ダッシュボード**に戻り、 **[リソースの作成]** を選択し、 **[Compute]** を選択してから、**Windows Server 2019 Datacenter ギャラリー項目**を選択します。

5.  **[基本]** ブレードで、次の操作を行います。

    a.  **Name**:VM001

    b.  **ユーザー名**: localadmin

    c.  **[パスワード]** 、 **[パスワードの確認]** : \<ご自分が選択したパスワード>

    d.  **サブスクリプション**: \<コンピューティング/ストレージ/ネットワーク リソースについてご自分が選択したサブスクリプション>

    e. **[リソース グループ]** :新規作成: storagetesting

    f.  **[OK]** を選択します。

6.  **[サイズの選択]** ブレードで **Standard_F8s_v2** を選択します。

7.  **[設定]** ブレードで **[仮想ネットワーク]** を選択し、 **[仮想ネットワークの作成]** ブレードでアドレス空間を **10.10.10.0/23** に調整し、[サブネット アドレス範囲] を **10.10.10.0/24** に更新し、 **[OK]** を選択します。

8.  **[パブリック IP アドレス]** を選択し、 **[パブリック IP アドレスの作成]** ブレードで **[静的]** を選択します。

9.  **[パブリック受信ポートを選択]** で、 **[RDP (3389)]** を選択します。

10. 他の既定値をそのまま使用し、 **[OK]** を選択します。
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image3.png)

11. 概要を読み、検証を待ってから **[OK]** を選択し、デプロイを開始します。 デプロイは約 10 分で完了します。

12. デプロイが完了したら、 **[リソース]** で 仮想マシン名 **VM001** を選択し、 *[概要]* ブレードにアクセスします。
    
    ![](./media/azure-stack-network-howto-extend-datacenter/image4.png)

13. [DNS 名] で **[構成]** を選択し、DNS 名ラベル **vm001** を指定し、 **[保存]** を選択し、階層リンクの **[VM001]** を選択して *[概要]* ブレードに戻ります。

14. [概要] ブレードの右側にある仮想ネットワーク/サブネットのテキストで **storagetesting-vnet/default** を選択します。

15. storagetesting-vnet ブレード内で **[サブネット]** 、 **[+サブネット]** の順に選択し、次の情報を入力します。 

    a.  **名前**: subnet2

    b.  **アドレス範囲 (CIDR ブロック)** :10.10.11.0/24

    c. **ネットワーク セキュリティ グループ**:なし

    d.  **[ルート テーブル]** :なし

    e. **[OK]** を選択します。

16. 保存されたら、階層リンクの **[VM001]** を選択して概要ブレードに戻ります。

17. **[ネットワーク]** を選択します。

18. **[ネットワーク インターフェイスの接続]** を選択し、 **[ネットワーク インターフェイスの作成]** を選択します。

19. **[ネットワーク インターフェイスの作成]** ブレードで次のようにします。

    a.  **名前**: vm001nic2

    b.  **サブネット**:サブネットが 10.10.11.0/24 であることを確認します

    c. **[ネットワーク セキュリティ グループ]** : VM001-nsg

    d.  **リソース グループ**: storagetesting

20. 正常に作成されたら、階層リンクの **[VM001]** を選択し、 **[停止]** を選択して VM をシャットダウンします。

21. VM が停止 (割り当て解除) されたら、 **[ネットワーク]** を選択し、 **[ネットワーク インターフェイスの接続]** を選択し、 **[vm001nic2]** を選択して **[OK]** を選択します。 しばらくしてから、VM に NIC を追加します。

22. **[ネットワーク]** ブレードで、 **[vm001nic2]** タブを選択し、 **[ネットワーク インターフェイス: vm001nic2]** を選択します。

23. vm001nic インターフェイス ブレードで **[IP 構成]** を選択し、ブレードの中央にある **[ipconfig1]** を選択します。

24. ipconfig1 の設定ブレードで、[パブリック IP アドレス] に **[有効]** を選択し、 **[必要な設定の構成]** 、 **[新規作成]** の順に選択し、名前に「vm001nic2pip」と入力し、 **[静的]** を選択し、 **[OK]** 、 **[保存]** の順に選択します。

25. 正常に保存されたら、VM001 の概要ブレードに戻り、 **[開始]** を選択して、構成された Windows Server 2019 VM を開始します。

### <a name="configure-the-windows-server-2019-file-server-storage"></a>Windows Server 2019 ファイル サーバー ストレージを構成する

この最初の例では、Windows Server 2019 ファイル サーバーが Hyper-V で実行されている仮想マシンである構成を検証します。 この仮想マシンは、8 つの仮想プロセッサ、1 つの VHDX ファイル、そして最も重要な 2 つの仮想ネットワーク アダプターで構成されます。 理想的なシナリオでは、これらのネットワーク アダプターはルーティング可能なサブネットが異なりますが、このテストでは、同じサブネット上にネットワーク アダプターがあります。

![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

ファイル サーバーの場合、Windows Server 2016 または 2019、物理または仮想、Hyper-V、VMware、または選択した代替プラットフォームで実行できます。 ここで重要な焦点は、Azure Stack システムとの相互接続ですが、ソースと宛先の間に複数のパスを用意することが推奨されます。これは、追加の冗長性を実現し、SMB マルチチャネルなど、より高度な機能を使用してパフォーマンスを向上させるためです。

ファイル共有の構成に進む前に、最新の累積的な更新プログラムと修正プログラムでファイル サーバーを更新して再起動します。

更新して再起動すると、このサーバーをファイル サーバーとして構成できるようになります。

1) ファイル サーバー マシン上で、**CMD** から **ipconfig /all** を実行し、ファイル サーバーで使用されている **DNS サーバー**をメモしておきます。

2)  **[サーバー マネージャー]** を開き、 **[管理]** 、 **[役割と機能の追加]** の順に選択します。

3)  **[次へ]** を選択し、 **[役割ベースまたは機能ベースのインストール]** を選択し、 **[サーバーの役割の選択]** ページまで選択を進めます。

4)  **[ファイル サービスと記憶域サービス]** を展開し、 **[File & iSCSI Services]\(ファイルと iSCSI サービス\)** を展開し、 **[ファイル サーバー]** ボックスを選択します。 完了したら、 **[サーバー マネージャー]** を閉じます。

5)  **[サーバー マネージャー]** を再び開き、 **[ファイル サービスと記憶域サービス]** を選択します。

6)  **[共有]** を選択します。

7)  **[共有]** ボックスで、 **[ファイル共有を作成するには、新しい共有ウィザードを実行してください]** リンクを選択します。

8)  **[新しい共有ウィザード]** ボックスで、 **[SMB 共有 - 簡易]** を選択し、 **[次へ]** を選択します。ウィザードの手順を進めて、**C:\\\\ボリューム**を選択します。

9)  共有に **TestStorage** と名前を付け、、 **[次へ]** を選択します。

10) **新しい共有ウィザード**に戻り、 **[次へ]** 、 **[作成]** 、 **[閉じる]** の順に選択します。

これで、ファイル サーバー上にファイル共有が作成されました。

### <a name="testing-file-storage-performance-and-connectivity"></a>ファイル ストレージのパフォーマンスと接続性のテスト

通信を確認し、いくつかの基本的なテストを実行するには、**Azure Stack** システム上で Azure Stack ユーザー ポータルに再度ログインし、**VM001** の**概要**ブレードに移動します。

1)  **[接続]** を選択して VM001 への RDP 接続を確立します。

2)  ホスト名を使用して通信するには、**Hosts** ファイルを編集します。ただし、運用環境では、名前が自動的に解決されるように DNS を最適に構成します。 IP アドレスを使用することもできます。 ただし、この例では、**Hosts** ファイルを編集します。

3)  **[管理者として実行]** を使用して**メモ帳**を開きます。

4)  メモ帳を開いたら、 **[ファイル]** 、 **[開く]** を選択し、c:\\Windows\System32\Drivers\etc\, を参照し、開いているダイアログ ボックスの右下で **[すべてのファイル]** を選択します。 **hosts** ファイルを選択し、 **[開く]** を選択します。

5)  hosts ファイルを編集し、ファイル サーバーの IP アドレスと DNS 名を追加します。

    ![](./media/azure-stack-network-howto-extend-datacenter/image6.png)

6)  ファイルを保存して、メモ帳を閉じます。

7)  **CMD** を開き、hosts ファイルに入力したファイル サーバーの名前を ping します。 これにより、ファイル サーバー上のいずれかのネットワーク アダプターの IP アドレスが返されるため、IP アドレスに ping して、他のアダプターとの通信を手動でテストします。

## <a name="connect-to-a-windows-server-iscsi-target-server"></a>Windows Server iSCSI ターゲット サーバーに接続する

このシナリオでは、Azure Stack 上で Windows Server 2019 の仮想マシンをデプロイして構成し、外部の iSCSI ターゲット サーバー (ここでも Windows Server 2019 が実行されます) に接続するように準備します。

> [!Note]  
> シナリオ 1 を既に完了している場合は、先に進んでマシンをカスタマイズします。

### <a name="deploy-the-windows-server-2019-vm-on-azure-stack"></a>Windows Server 2019 VM を Azure Stack にデプロイする

Azure Stack に Windows Server 2019 VM をまだデプロイしていない場合は、「[Windows Server 2019 VM を Azure Stack にデプロイする](#deploy-the-windows-server-2019-vm-on-azure-stack)」の手順に従ってください。 その後、Windows Server 2019 iSCSI ターゲットを構成できます。

### <a name="configure-the-windows-server-2019-iscsi-target"></a>Windows Server 2019 iSCSI ターゲットを構成する

この 2 つ目のシナリオでは、Windows Server 2019 iSCSI ターゲットが Hyper-V 上で実行されている仮想マシンである構成を検証します。 この仮想マシンは、8 つの仮想プロセッサ、1 つの VHDX ファイル、そして最も重要な 2 つの仮想ネットワーク アダプターで構成されます。 理想的なシナリオでは、これらのネットワーク アダプターはルーティング可能なサブネットが異なりますが、このテストでは、同じサブネット上にネットワーク アダプターがあります。

![](./media/azure-stack-network-howto-extend-datacenter/image5.png)

iSCSI ターゲットの場合、Windows Server 2016 または 2019、物理または仮想、Hyper-V、VMware、または選択した代替プラットフォームで実行できます。 ここで重要な焦点は、Azure Stack システムとの相互接続ですが、ソースと宛先の間に複数のパスを用意することが推奨されます。これは、追加の冗長性とスループットを実現するためです。

iSCSI ターゲット サーバーの構成に進む前に、最新の累積的な更新プログラムと修正プログラムでファイル サーバーを更新して再起動します。

更新して再起動すると、このサーバーを iSCSI ターゲット サーバーとして構成できるようになります。

## <a name="next-steps"></a>次の手順

[Azure Stack ネットワークの違いと考慮事項](azure-stack-network-differences.md)  