---
title: Azure Stack HCI をデプロイする前に
description: Azure Stack HCI のデプロイを準備する方法。
author: khdownie
ms.author: v-kedow
ms.topic: how-to
ms.date: 09/03/2020
ms.openlocfilehash: 1cffde5eb3fa29357a71a0d6ca397f1da1b63879
ms.sourcegitcommit: 7c01ab4b2e2250a7acd67d1c5ba27d15c1e8bce0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/04/2020
ms.locfileid: "89448607"
---
# <a name="before-you-deploy-azure-stack-hci"></a>Azure Stack HCI をデプロイする前に

> 適用対象:Azure Stack HCI バージョン 20H2

この攻略ガイドでは、以下の方法について説明します。

- お使いのハードウェアが標準 (単一サイト) またはストレッチ (2 サイト) の Azure Stack HCI クラスターの基本要件を満たしているかどうかを判断する
- サポートされている最大ハードウェア仕様を超えていないことを確認する
- デプロイが成功するために必要な情報を収集する
- 管理用 PC またはサーバーに Windows Admin Center をインストールする

## <a name="determine-hardware-requirements"></a>ハードウェア要件を判断する

Microsoft のパートナーから Azure Stack HCI ハードウェア/ソフトウェアの検証済みソリューションを購入することをお勧めします。 これらのソリューションは、互換性と信頼性を確保するために、Microsoft の参照アーキテクチャに照らして設計、組み立て、検証されているため、迅速に稼働させることができます。 お使いのシステム、コンポーネント、デバイス、ドライバーが、Windows Server カタログで認定されている Windows Server 2019 であることを確認します。 検証済みソリューションについては、[Azure Stack HCI ソリューション](https://azure.microsoft.com/overview/azure-stack/hci)の Web サイトを参照してください。

### <a name="server-requirements"></a>サーバーの要件

- 標準の Azure Stack HCI クラスターでは、最低 2 台、最大 16 台のサーバーが必要です。ただし、クラスター セットを使用して複数のクラスターを結合し、数百台のノードからなる HCI プラットフォームを作成することができます。
- ストレッチ クラスターでは、2 つの別個のサイトにサーバーをデプロイする必要があります。 これらのサイトは、異なる国、異なる都市、異なる階、または異なる部屋に配置できます。 ストレッチ クラスターでは、最低 4 台 (サイトあたり 2 台)、最大 16台 (サイトあたり 8 台) のサーバーが必要になります。
- サーバーはすべて、同じ製造元とモデルのものを使用することをお勧めします。また、64 ビット Intel Nehalem グレード、AMD EPYC グレード、または、第 2 レベルのアドレス変換 (SLAT) を備えたそれ以降の互換プロセッサを使用することが推奨されます。 Intel Optane DC 永続メモリをサポートするには、第 2 世代の Intel Xeon スケーラブル プロセッサが必要です。 プロセッサは 1.4 GHz 以上で、x64 命令セットと互換性がある必要があります。
- サーバーのオペレーティング システム、VM、およびその他のアプリやワークロードに対応するために、サーバーにはノードごとに少なくとも 32 GB の RAM が搭載されていることを確認してください。 さらに、記憶域スペース ダイレクトのメタデータ用に各サーバーで 1 テラバイト (TB) のキャッシュ ドライブ容量ごとに 4 GB の RAM を確保します。
- BIOS または UEFI で以下の仮想化サポートが有効になっていることを確認してください。
    - ハードウェア補助による仮想化。 これは、仮想化オプションを含むプロセッサ、具体的には Intel Virtualization Technology (Intel VT) または AMD Virtualization (AMD-V) テクノロジーを使用したプロセッサで利用できます。
    - ハードウェアによるデータ実行防止 (DEP) が使用可能で、有効になっている必要があります。 Intel システムの場合、これは XD ビット (execute disable bit) です。 AMD システムの場合、これは NX ビット (no execute bit) です。
- Windows Server でサポートされている任意のブート デバイス ([SATADOM](https://cloudblogs.microsoft.com/windowsserver/2017/08/30/announcing-support-for-satadom-boot-drives-in-windows-server-2016/) を含む) を使用できます。 RAID 1 ミラーは**不要**ですが、ブートでサポートされています。 200 GB の最小サイズが推奨されます。
- Hyper-V の機能固有のその他の要件については、「[Windows Server 上の Hyper-v のシステム要件](/windows-server/virtualization/hyper-v/system-requirements-for-hyper-v-on-windows)」を参照してください。

### <a name="networking-requirements"></a>ネットワーク要件

Azure Stack HCI クラスターでは、各サーバー ノード間に信頼性が高く、高帯域幅で低待機時間のネットワーク接続が必要になります。 以下の項目について確認します。

- クラスター管理専用に少なくとも 1 つのネットワーク アダプターが使用可能であることを確認します。
- 使用するすべての VLAN 上のトラフィックを許可するようにネットワーク内の物理スイッチが構成されていることを確認します。


サーバー ノード間で行われる通信には、次のような複数の種類があります。

- クラスター通信 (ノードの結合、クラスターの更新、レジストリの更新)
- クラスター ハートビート
- クラスター共有ボリューム (CSV) のリダイレクト トラフィック
- 仮想マシンのライブ マイグレーション トラフィック

記憶域スペース ダイレクトでは、次のような追加のネットワーク トラフィックを考慮する必要があります。

- 記憶域バス レイヤー (SBL) – ノード間で分散されるエクステントまたはデータ
- 正常性 – オブジェクト (ノード、ドライブ、ネットワーク カード、クラスター サービス) の監視と管理

ストレッチ クラスターの場合は、さらにサイト間の記憶域レプリカのトラフィックも発生します。 記憶域バス レイヤー (SBL) とクラスター共有ボリューム (CSV) のトラフィックは、サイト間ではなく、各サイト内のサーバー ノード間でのみ発生します。

### <a name="domain-requirements"></a>ドメインの要件

Azure Stack HCI にはドメイン機能レベルの特別な要件はありません。お使いのドメイン コントローラー用に現在サポートされているオペレーティング システムのバージョンのみ確認が必要になります。 一般的なベスト プラクティスとして、Active Directory のごみ箱機能を有効にすることをお勧めします (まだ行っていない場合)。

### <a name="interconnect-requirements-between-nodes"></a>ノード間の相互接続要件

ここでは、"相互接続" と呼ばれる、サイト内のサーバー ノード間の具体的なネットワーク要件について説明します。 スイッチ ノードまたはスイッチレス ノードの相互接続を次のように使用できます。

- **スイッチ:** サーバー ノードは通常、ネットワーク スイッチを使用するイーサネット ネットワーク経由で相互接続されます。 帯域幅とネットワークの種類に対応するようにスイッチを適切に構成する必要があります。 RoCE プロトコルを実装する RDMA を使用する場合は、ネットワーク　デバイスとスイッチの構成が重要になります。
- **スイッチレス:** サーバー ノードは、スイッチを使用せずに直接イーサネット接続を使用して相互接続することもできます。 この場合、各サーバー ノードは、同じサイト内の他のすべてのクラスター ノードと直接接続している必要があります。

#### <a name="interconnects-for-2-3-node-clusters"></a>2 または 3 ノードのクラスターの相互接続

以下は、2 つまたは 3 つのノードを持つ単一サイト クラスターについての "*最小*" の相互接続要件です。 これらは、サーバー ノードごとに適用されます。

- 管理機能に使用する 1 つ以上の 1 Gb ネットワーク アダプター カード
- ストレージとワークロードのトラフィック用に 1 つ以上の 10 Gb (またはそれ以上) のネットワーク インターフェイス カード
- 各ノード間に 2 つ以上のネットワーク接続 (冗長性とパフォーマンスのために推奨)

#### <a name="interconnects-for-4-node-and-greater-clusters"></a>4 ノード以上のクラスターの相互接続

以下は、4 つ以上のノードを持つクラスターと、高パフォーマンス クラスターについての "*最小*" の相互接続要件です。 これらは、サーバー ノードごとに適用されます。

- 管理機能に使用する 1 つ以上の 1 Gb ネットワーク アダプター カード。
- ストレージとワークロードのトラフィック用に 1 つ以上の 25 Gb (またはそれ以上) のネットワーク インターフェイス カード。 冗長性とパフォーマンスのために 2 つ以上のネットワーク接続が推奨されます。
- リモート ダイレクト メモリ アクセス (RDMA) 対応のネットワーク カード: iWARP (推奨) または RoCE。

### <a name="site-to-site-requirements-stretched-cluster"></a>サイト間の要件 (ストレッチ クラスター)

ストレッチ クラスターでサイト間接続を行う場合、各サイト内の相互接続要件が引き続き適用され、記憶域レプリカと Hyper-V ライブ マイグレーションのトラフィックに関する以下の追加要件を考慮する必要があります。

- 同期レプリケーション用にサイト間で少なくとも 1 つの 1 Gb RDMA またはイーサネット/TCP 接続。 25 Gb の RDMA 接続をお勧めします。
- サイト間のネットワーク。I/O 書き込みワークロードを格納するのに十分な帯域幅を備え、同期レプリケーションでの平均ラウンド トリップ待機時間が 5ms 以内のもの。 非同期レプリケーションには待機時間に関する推奨事項はありません。
- サイト間で単一の接続を使用する場合は、PowerShell を使用して記憶域レプリカの SMB 帯域幅の制限を設定します。 詳細については、「[Set-SmbBandwidthLimit](/powershell/module/smbshare/set-smbbandwidthlimit?view=win10-ps)」を参照してください。
- サイト間で複数の接続を使用する場合は、接続間でトラフィックを分離します。 たとえば、記憶域レプリカのトラフィックを、PowerShell を使用した Hyper-V のライブ マイグレーションのトラフィックとは別のネットワークに配置します。 詳細については、「[Set-SRNetworkConstraint](/powershell/module/storagereplica/set-srnetworkconstraint?view=win10-ps)」を参照してください。

### <a name="network-port-requirements"></a>ネットワーク ポートの要件

サイト内およびサイト間 (ストレッチ クラスターの場合) の両方のすべてのサーバー ノード間で、適切なネットワーク ポートが開いていることを確認します。 ファイアウォールとルーターには、クラスター内のすべてのサーバー間で ICMP、SMB (ポート 445、および SMB ダイレクト用のポート 5445)、WS-MAN (ポート 5985) の双方向トラフィックを許可するための適切な規則が必要になります。

Windows Admin Center で [クラスターの作成] ウィザードを使用してクラスターを作成すると、クラスター内の各サーバーで、フェールオーバー クラスタリング、Hyper-V、記憶域レプリカ用の該当するファイアウォール ポートがウィザードによって自動的に開かれます。 各サーバーで異なるソフトウェア ファイアウォールを使用している場合は、次のポートを開きます。

#### <a name="failover-clustering-ports"></a>フェールオーバー クラスタリングのポート

- ICMPv4 および ICMPv6
- TCP ポート 445
- RPC 動的ポート
- TCP ポート 135
- TCP ポート 137
- TCP ポート 3343
- UDP ポート 3343

#### <a name="hyper-v-ports"></a>Hyper-V ポート

- TCP ポート 135
- TCP ポート 80 (HTTP 接続)
- TCP ポート 443 (HTTPS 接続)
- TCP ポート 6600
- TCP ポート 2179
- RPC 動的ポート
- RPC エンドポイント マッパー
- TCP ポート 445

#### <a name="storage-replica-ports-stretched-cluster"></a>ストレージ レプリカ ポート (ストレッチ クラスター)

- TCP ポート 445
- TCP 5445 (iWarp RDMA を使用している場合)
- TCP ポート 5985
- ICMPv4 および ICMPv6 (Test-SRTopology を使用している場合)

上記の一覧にないポートが追加で必要になる場合があります。 これらは、Azure Stack HCI の基本機能用のポートです。

### <a name="storage-requirements"></a>ストレージの要件

- Azure Stack HCI は直接接続された SATA、SAS、NVMe、または永続メモリのドライブに対応しています。これらは、それぞれ 1 台のサーバーのみに物理的に接続されます。
- 同じクラスター内のすべてのサーバーで、ドライブの種類が同じであり、それぞれの種類のドライブ数も同じである必要があります。 また、ドライブは同じサイズおよびモデルにすることをお勧めします (必須ではありません)。 ドライブは、サーバーの内部、または 1 台のサーバーにのみ接続されている外部エンクロージャに配置できます。 詳細については、[ドライブの対称性に関する考慮事項](../concepts/drive-symmetry-considerations.md)に関するページを参照してください。
- クラスター内の各サーバーには、ログ用の専用ボリュームが必要になり、ログ ストレージの速度は少なくともデータ ストレージと同じでなければなりません。 ストレッチ クラスターには少なくとも 2 つのボリュームが必要です。1 つはレプリケートされたデータ用で、もう 1 つはログ データ用です。
- スロットのマッピングと識別のために SCSI エンクロージャ ービス (SES) が必要になります。 各外部エンクロージャは、一意識別子 (一意の ID) を提示する必要があります。 **サポート対象外:** RAID コントローラー カードまたは SAN (ファイバー チャネル、iSCSI、FCoE) 記憶域、複数のサーバーに接続されている共有 SAS エンクロージャ、または複数のパスからドライブにアクセスできる任意の形式のマルチパス IO (MPIO)。 ホスト バス アダプター (HBA) カードは、単純なパススルー モードを実装する必要があります。
- 詳細については、[ドライブの選択](../concepts/choose-drives.md)に関するトピック、または「[記憶域スペース ダイレクトのハードウェア要件](/windows-server/storage/storage-spaces/storage-spaces-direct-hardware-requirements)」を参照してください。
- ボリュームと回復性に使用できるオプションについては、「[記憶域スペース ダイレクトのボリュームの計画](/windows-server/storage/storage-spaces/plan-volumes#choosing-the-resiliency-type)」のトピックを参照してください。
- 仮想マシンおよび仮想化された記憶域もデプロイする場合は、「[ゲスト仮想マシン クラスターでの記憶域スペース ダイレクトの使用](/windows-server/storage/storage-spaces/storage-spaces-direct-in-vm)」を参照してください。

## <a name="review-maximum-supported-hardware-specifications"></a>サポートされているハードウェア最大仕様を確認する

次の仕様を超える Azure Stack HCI のデプロイはサポートされていません。

| リソース                     | 最大値 |
| ---------------------------- | --------|
| クラスターあたりの物理サーバー数 | 16      |
| ホストあたりの VM 数                 | 1,024   |
| VM あたりのディスク数 (SCSI)          | 256     |
| クラスターあたりのストレージ          | 4 PB    |
| サーバーあたりのストレージ           | 400 TB  |
| ホストあたりの論理プロセッサ数  | 512     |
| ホストあたりの RAM                 | 24 TB   |
| VM あたりの RAM                   | 12 TB (第 2 世代 VM) または 1 TB (第 1 世代)|
| ホストあたりの仮想プロセッサ数  | 2,048   |
| VM あたりの仮想プロセッサ数    | 240 (第 2 世代 VM) または 64 (第 1 世代)|

## <a name="gather-information"></a>情報を収集する

デプロイを準備するために、環境に関する以下の詳細情報を収集してください。

- **サーバー名:** コンピューター、ファイル、パス、およびその他のリソースに関する組織の名前付けポリシーについて理解を深めてください。 複数のサーバーをプロビジョニングする場合、それぞれに一意の名前を付ける必要があります。
- **ドメイン名:** ドメインの名前付けとドメイン参加に関する組織のポリシーについて理解を深めてください。 サーバーをドメインに参加させ、ドメイン名を指定する必要があります。
- **静的 IP アドレス:** Azure Stack HCI では、記憶域およびワークロード (VM) トラフィックに静的 IP アドレスを使用する必要があります。DHCP を使用した動的 IP アドレスの割り当てはこの高速ネットワークではサポートされていません。 管理ネットワーク アダプターで DHCP を使用できます。ただし、チームで 2 つ使用している場合は DHCP を使用できず、静的 IP を使用する必要があります。 クラスター内の各サーバーに使用する IP アドレスについては、ネットワーク管理者にお問い合わせください。
- **RDMA ネットワーク:** RDMA プロトコルには、iWarp と RoCE の2種類があります。 ネットワーク アダプターでどちらの種類が使用されているか確認し、RoCE の場合は、そのバージョン (v1 または v2) にも注意してください。 RoCE では、Top-of-Rack スイッチのモデルも確認してください。
- **VLAN ID:** サーバーのネットワーク アダプターに使用する VLAN ID をメモしておきます (存在する場合)。 これは、ネットワーク管理者から入手できるはずです。
- **サイト名:** ストレッチ クラスターの場合、ディザスター リカバリーに 2 つのサイトが使用されます。 サイトは、Active Directory Domain Services を使用して設定できるほか、クラスターの作成ウィザードで自動的に設定することもできます。 サイトの設定については、ドメイン管理者に問い合わせてください。 また、詳細については、「[Active Directory Domain Services の概要](/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview)」を参照してください。

## <a name="install-windows-admin-center"></a>Windows Admin Center をインストールする

Windows Admin Center は、ローカルにデプロイされるブラウザーベースのアプリであり、Azure Stack HCI の管理に使用します。 [Windows Admin Center をインストールする](/windows-server/manage/windows-admin-center/deploy/install)方法として最も簡単なのはローカル管理 PC にインストールすること (デスクトップ モード) ですが、サーバーにインストールすること (サービス モード) もできます。

Windows Admin Center をサーバーにインストールする場合、CredSSP が必要なタスク (クラスター作成や更新プログラムのインストールなど) では、Windows Admin Center サーバー上のゲートウェイ管理者グループのメンバーであるアカウントを使用する必要があります。 詳細については、「[ユーザー アクセス制御とアクセス許可を構成する](/windows-server/manage/windows-admin-center/configure/user-access-control#gateway-access-role-definitions)」の最初の 2 つのセクションを参照してください。

## <a name="next-steps"></a>次のステップ

次の記事に進んで、Azure Stack HCI オペレーティング システムのデプロイ方法を学習してください。
> [!div class="nextstepaction"]
> [Azure Stack HCI オペレーティング システムのデプロイ](operating-system.md)
